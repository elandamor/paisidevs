"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),Movie=function(){function t(){_classCallCheck(this,t),this.body=document.body,this.container=document.querySelector(".l-movies-list"),this.movie=[].slice.call(this.container.children),this.dv=document.querySelector(".l-dv"),this.underlay=document.querySelector(".l-dv-underlay"),this.sidebarL=this.dv.querySelector(".l-dv-sidebar__L"),this.sidebarR=this.dv.querySelector(".l-dv-sidebar__R"),this.content=this.dv.querySelector(".l-dv-content"),this.metaDirector=this.dv.querySelector(".director-holder"),this.metaWriter=this.dv.querySelector(".writers-holder"),this.metaRuntime=this.dv.querySelector(".meta-runtime"),this.metaRating=this.dv.querySelector(".meta-rating"),this.metaGenre=this.dv.querySelector(".genre-holder"),this.metaStoryline=this.dv.querySelector(".storyline-holder"),this.metaCast=this.dv.querySelector(".cast-holder"),this.metaTrivia=this.dv.querySelector(".trivia-holder"),this.metaQuotes=this.dv.querySelector(".quotes-holder"),this.metaReviews=this.dv.querySelector(".reviews-holder"),this.promote=this.promote.bind(this),this.animations=this.animations.bind(this),this.resetAnimations=this.resetAnimations.bind(this),this.animatePoster=this.animatePoster.bind(this),this.resetPoster=this.resetPoster.bind(this),this.loadDetails=this.loadDetails.bind(this),this.animateDetails=this.animateDetails.bind(this),this.resetDetails=this.resetDetails.bind(this),this.animateUnderlay=this.animateUnderlay.bind(this),this.resetUnderlay=this.resetUnderlay.bind(this),this.keyTriggered=!1,this.addEventListeners()}return _createClass(t,[{key:"addEventListeners",value:function(){var t=this;this.movie.forEach(function(e,i){e.addEventListener("click",function(e){var i=e.target;if(i.classList.contains("l-dv--trigger")||t.keyTriggered){var s=i.parentNode;t.poster=s.querySelector(".c-card-poster"),t.metadata=s.querySelector(".c-card-metadata");var r={method:"GET",headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:"null"},a=new Fetch("/__server/json/muvizone-db.json",r);a.data().then(function(e){var i=navigate.getIndex(),s=e.movies[i],r=function a(t){var e=t.split("h"),a=60*parseInt(e[0])+parseInt(e[1]);return a};t.title=s.title.split(/: |:/g),t.year=s.release_year,t.runtime=r(s.runtime),t.genre=s.genre.split(/, |,/g),t.rating=s.content_rating,t.director=s.director.split(/, |,/g),t.writer=s.writer.split(/, |,/g),t.cast=s.cast.split(/, |,/g),t.storyline=s.storyline?s.storyline:s.summary,t.trivia=s.trivia?s.trivia:"",t.quotes=s.quotes?s.quotes:"",t.reviews=s.reviews?s.reviews:"",t.animations()})}})}),document.addEventListener("keydown",function(e){var i=e.keyCode||e.which,s=27,r=13;if(i==r&&!t.body.classList.contains("detail-view")){e.preventDefault(),t.keyTriggered=!0;var a=document.createEvent("HTMLEvents");a.initEvent("click",!0,!1),t.movie[navigate.getIndex()].querySelector(".c-card-poster").dispatchEvent(a)}i==s&&t.body.classList.contains("detail-view")&&(e.preventDefault(),movie.resetAnimations())})}},{key:"promote",value:function(){this.container.classList.add("no-pointer-events"),this.metadata.classList.add("is-faded-out"),this.metadata.style.transitionDuration=".15s"}},{key:"animations",value:function(){return this.poster.classList.contains("is-animated")?void this.resetAnimations():(this.promote(),requestAnimationFrame(this.animatePoster),this.loadDetails(),requestAnimationFrame(this.animateUnderlay),void requestAnimationFrame(this.animateDetails))}},{key:"resetAnimations",value:function(){this.container.classList.remove("no-pointer-events"),requestAnimationFrame(this.resetDetails),requestAnimationFrame(this.resetPoster),requestAnimationFrame(this.resetUnderlay)}},{key:"animatePoster",value:function(){var t=this,e=function h(e){console.timeEnd("meta-poster-animation"),t.poster.classList.add("is-animated"),t.poster.removeEventListener("transitionend",h)};this.body.classList.add("detail-view"),this.posterBCR=this.poster.getBoundingClientRect();var i=document.querySelector(".app-header").getBoundingClientRect().height,s=0,r=250,a=24,n=s-Math.ceil(this.posterBCR.left),o=i-Math.ceil(this.posterBCR.top),l=Math.abs((r-2*a)/this.posterBCR.width);console.log("scaleRatio",l),console.time("meta-poster-animation"),this.poster.style.willChange="transform",this.poster.style.transform="translate("+n+"px,"+o+"px)",this.poster.addEventListener("transitionend",e)}},{key:"resetPoster",value:function(){var t=this,e=function i(e){t.poster.removeEventListener("transitionend",i)};this.metadata.classList.remove("is-faded-out"),this.metadata.style.transitionDuration=".5s",this.poster.style.willChange="initial",this.poster.style.transform="",this.poster.classList.remove("is-animated"),this.body.classList.remove("detail-view"),this.poster.addEventListener("transitionend",e)}},{key:"loadDetails",value:function(){console.time("load-details"),this.dv.querySelector(".title").textContent="",this.dv.querySelector(".subtitle").textContent="",this.dv.querySelector(".title").textContent=this.title[0],this.dv.querySelector(".subtitle").textContent=this.title[1]?": "+this.title[1]:"",this.dv.querySelector(".release-year").textContent=this.year,this.metaGenre.innerHTML="";for(var t in this.genre){var e=this.genre[t],i='<a class="genre">'+e+"</a>";this.metaGenre.innerHTML+=i}this.metaDirector.innerHTML="";for(var s in this.director){var r=this.director[s],a='<a class="director">'+r+"</a>";this.metaDirector.innerHTML+=a}this.metaWriter.innerHTML="";for(var n in this.writer){var o=this.writer[n],l='<a class="writer">'+o+"</a>";this.metaWriter.innerHTML+=l}this.metaRuntime.innerHTML='<a class="runtime">'+this.runtime+" min</a>",this.metaRating.className="meta-rating",this.metaRating.classList.add("rated-"+this.rating),this.metaStoryline.innerHTML="",this.metaStoryline.innerHTML=this.storyline,this.metaCast.innerHTML="";for(var h in this.cast){var d=(this.cast[h],'<figure class="actor-avatar"><img/><figcaption class="actor"></figcaption></figure>');this.metaCast.innerHTML+=d}var c=this.title[0];void 0!=this.title[1]&&(c+=this.title[1]?": "+this.title[1]:""),document.querySelector(".soundtrack-holder .c-card__header span").innerHTML=c,this.metaReviews.innerHTML="";for(var v in this.reviews){var m=this.reviews[v].tagline,u=this.reviews[v].body,y='<div class="review user-review"><h4 class="meta-tagline">'+m+'</h4><div class="meta-body">'+u+"</div></div>";this.metaReviews.innerHTML+=y}requestAnimationFrame(function(t){console.timeEnd("load-details")})}},{key:"animateDetails",value:function(){this.content.scrollTop=0,this.metaCast.scrollLeft=0,this.dv.classList.add("is-visible"),this.dv.style.transitionDuration=".5s"}},{key:"resetDetails",value:function(){this.dv.classList.remove("is-visible"),this.dv.style.willChange="initial",this.dv.style.transitionDuration=".2s"}},{key:"animateUnderlay",value:function(){var t=this,e=function i(e){t.underlay.removeEventListener("transitionend",i)};this.underlay.style.willChange="opacity, transform",this.underlay.style.transform="scale(1)",this.underlay.style.opacity=1,this.underlay.style.transformOrigin=this.posterBCR.left+"px "+this.posterBCR.top+"px",this.underlay.addEventListener("transitionend",e)}},{key:"resetUnderlay",value:function(){this.underlay.style.willChange="initial",this.underlay.style.transform="scale(0)"}}]),t}(),movie=new Movie;